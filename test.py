from flask import Flask, render_template, request
from feature_Extraction import create_vector_single, extract_features
import os
import pickle

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = "uploads/"


@app.route('/predict', methods=['POST'])
def analyze():
    if request.method == 'POST':
        f = request.files.get('file', None)
        if f:
            fp = os.path.join(app.config['UPLOAD_FOLDER'], f.filename)
            f.save(fp)
            features = extract_features(fp)
            feature_vector = create_vector_single(features)
            arr = []
            arr.append(feature_vector)
            model = pickle.load(open("xgb.p", "rb"))
            mod = pickle.load(open("feature_model.p", "rb"))
            arr = mod.transform(arr)
            result = model.predict(arr)
            label = {}
            if int(result[0]) == 1:
                label["svm"] = "Malware"
            else:
                label["svm"] = "Goodware"
        else:
            label = None
    return render_template("index.html", label=label)

@app.route('/')
def index():
    return render_template("index.html")

@app.route('/result')
def res():
    return render_template("result.html")

if __name__ == '__main__':
    app.run(debug=True)



